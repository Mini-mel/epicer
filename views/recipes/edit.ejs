<%layout("layouts/boilerplate");%>

<main class="form-main">
    <div class="form-card">
        <form class="form-content" action="/recipes" method="PUT">
            <h1>Edit Recipe</h1>
            <div class="form-field">
                <label for="title">Title</label><br>
                <input type="text" id="title" class="not-ingredients" name="recipe[title]" aria-label="title" value="<%=recipe.title %>" required>
            </div>

            <div class="form-field">
                <label for="instructions">Instructions</label><br>
                <textarea id="instructions" class="not-ingredients" name="recipe[instructions]"
                    aria-label="instructions" rows="20" required><%=recipe.instructions %></textarea>
            </div>

            <div class="form-field">
                <label for="image">Image Url</label><br>
                <input type="url" id="image" name="recipe[image]" aria-label="image url" value="<%=recipe.image %>" required>
            </div>

            <div class="form-field">
                <button type="button" class="add-field-button" id="addFieldButton" onclick="addField();">Add
                    Ingredient</button><br>
                <label for="ingredients">Ingredients</label><br>

                <div id="add-field-div">
                      <a href="<%= `/users/${user._id}/delete?_method=DELETE` %>"

                    <%Object.entries(recipe.ingredients).forEach((ingredient) => {%>
                    <input type="text" class="ingredients" id="ingredients" 
                        name="<recipe[ingredients][<%=ingredient[1].id %>][name]>" aria-label="ingredient" value="<%=ingredient[1].name%>" required>

                    <input type="number" value="1" min="0.1" max="100" step="0.1" 
                        name="recipe[ingredients][' + ingredientsCounter + '][amount]" aria-label="amount of ingredient" value="<%=ingredient[1].amount%>">

                    <select name="recipe[ingredients][' + ingredientsCounter + '][unit]" aria-label="units of measurement" value="<%=ingredient[1].unit%>">
                    <option></option>
                    <option>To taste</option>
                    <option>cup(s)</option>
                    <option>tsp(s)</option>
                    <option>tbsp(s)</option>
                    <option>gallon(s)</option>
                    <option>quart(s)</option>
                    </select>
                    <%})%>
                
                </div>

                <button class="center-button">Submit</button>
        </form>


        <a href="/recipes/<%=recipe._id%>" class=card-link data-cy="editRecipe">Go back</a>
    </div>
</main>

<script src="/scripts/addField.js"></script>